<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agenda | Grupo de Jovens</title>
  <meta name="description" content="Agenda JuvCBO" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="bg"></div>

  <header class="container header">
    <div class="brand">
  <div class="brand-logo">
    <img
      src="assets/juvcbo-logo2.png"
      alt="Logo Juvcbo"
    />
  </div>

  <div class="brand-text">
    <h1>Agenda JuvCBO</h1>
    <p id="subtitle"></p>
  </div>
</div>

    <div class="controls">
      <input
        id="searchInput"
        class="search"
        type="search"
        placeholder="Buscar por t√≠tulo, local ou tipo..."
      />
      
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="card-head">
        <div>
          <h2></h2>
          <p id="updatedAt" class="muted">Carregando‚Ä¶</p>
        </div>
        <span id="countBadge" class="badge">‚Äî</span>
      </div>

      <p id="status" class="status muted">Carregando agenda‚Ä¶</p>

      <div id="months" class="months"></div>

      <p class="footer-note muted">
        Dica: edite apenas o arquivo <code>events.json</code> para atualizar a agenda.
      </p>
    </section>
  </main>

  <footer class="container footer muted">
    ¬© <span id="year"></span> ‚Ä¢ Grupo de Jovens
  </footer>

  <script>
    const monthsEl = document.getElementById("months");
    const statusEl = document.getElementById("status");
    const searchInput = document.getElementById("searchInput");
    const togglePastBtn = document.getElementById("togglePastBtn");
    const countBadge = document.getElementById("countBadge");
    const updatedAtEl = document.getElementById("updatedAt");
    const subtitleEl = document.getElementById("subtitle");

    document.getElementById("year").textContent = new Date().getFullYear();

    let allEvents = [];
    let showPast = true; // ‚úÖ agora come√ßa mostrando TUDO (inclui janeiro)

    const MONTHS = [
      "Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho",
      "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"
    ];

    const WEEKDAYS = ["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"];

    function parseDateTime(value) {
      const parts = value.split("T");
      const d = parts[0].split("-");
      const t = (parts[1] || "00:00").split(":");

      return new Date(
        Number(d[0]),
        Number(d[1]) - 1,
        Number(d[2]),
        Number(t[0]),
        Number(t[1])
      );
    }

    function normalize(text) {
      return (text || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "");
    }

    function isPast(date) {
      return date.getTime() < Date.now();
    }

    function groupByMonth(events) {
      const map = {};

      events.forEach(function (ev) {
        const y = ev.date.getFullYear();
        const m = String(ev.date.getMonth() + 1).padStart(2, "0"); // ‚úÖ 01..12
        const key = y + "-" + m;

        if (!map[key]) map[key] = [];
        map[key].push(ev);
      });

      return map;
    }

    function render(events) {
      monthsEl.innerHTML = "";
      countBadge.textContent = String(events.length);

      if (events.length === 0) {
        statusEl.textContent = "Nenhum evento encontrado.";
        return;
      }

      statusEl.textContent = "";

      const grouped = groupByMonth(events);

      Object.keys(grouped)
        .sort() // com YYYY-MM ordena certinho
        .forEach(function (key) {
          const monthEvents = grouped[key].slice().sort(function (a, b) {
            return a.date.getTime() - b.date.getTime();
          });

          const refDate = monthEvents[0].date;

          const monthCard = document.createElement("section");
          monthCard.className = "month-card";

          monthCard.innerHTML = `
            <div class="month-head">
              <span class="month-title">${MONTHS[refDate.getMonth()]} ${refDate.getFullYear()}</span>
              <span class="month-count">${monthEvents.length} evento(s)</span>
            </div>
            <div class="month-events"></div>
          `;

          const list = monthCard.querySelector(".month-events");

          monthEvents.forEach(function (ev) {
            const day = String(ev.date.getDate()).padStart(2, "0");
            const weekday = WEEKDAYS[ev.date.getDay()];
            const time =
              String(ev.date.getHours()).padStart(2, "0") +
              ":" +
              String(ev.date.getMinutes()).padStart(2, "0");

            const eventEl = document.createElement("article");
            eventEl.className = "event-row" + (isPast(ev.date) ? " is-past" : "");

            const thumb = ev.image
              ? `<img class="event-thumb-img" src="${ev.image}" alt="Arte do evento: ${ev.title}" loading="lazy" />`
              : `<div class="event-thumb-ph">SEM<br>ARTE</div>`;

            eventEl.innerHTML = `
              <div class="event-date">
                <div class="event-day">${day}</div>
                <div class="event-weekday">${weekday}</div>
              </div>

              <div class="event-main">
                <div class="event-top">
                  <span class="pill">${ev.type || "Evento"}</span>
                  <h3 class="event-title">${ev.title || "Sem t√≠tulo"}</h3>
                </div>

                <div class="event-meta">
                  <span class="meta-chip">üìÖ <span>${weekday}</span></span>
                  <span class="meta-chip">‚è∞ <span>${time}</span></span>
                  ${ev.location ? `<span class="meta-chip">üìç <span>${ev.location}</span></span>` : ""}
                </div>

                ${ev.description ? `<p class="event-desc">${ev.description}</p>` : ""}
              </div>

              <div class="event-side">
                <div class="event-thumb">
                  ${thumb}
                </div>

                ${ev.link ? `<a class="btn btn-ghost" href="${ev.link}" target="_blank" rel="noopener">Mais detalhes</a>` : ""}
              </div>
            `;

            list.appendChild(eventEl);
          });

          monthsEl.appendChild(monthCard);
        });
    }

    function applyFilters() {
      const query = normalize(searchInput.value);

      const filtered = allEvents
        .filter(function (ev) {
          if (!showPast && isPast(ev.date)) return false;

          if (!query) return true;

          const text = normalize(
            (ev.title || "") + " " +
            (ev.type || "") + " " +
            (ev.location || "") + " " +
            (ev.description || "")
          );

          return text.includes(query);
        })
        .sort(function (a, b) {
          return a.date.getTime() - b.date.getTime();
        });

      render(filtered);

      subtitleEl.textContent = showPast
        ? ""
        : "Somente pr√≥ximos eventos";
    }


    searchInput.addEventListener("input", applyFilters);

    fetch("./events.json", { cache: "no-store" })
      .then(function (res) { return res.json(); })
      .then(function (data) {
        updatedAtEl.textContent = data.updatedAt ? "Atualizado em " + data.updatedAt : "";

        allEvents = (data.events || []).map(function (ev) {
          return Object.assign({}, ev, { date: parseDateTime(ev.datetime) });
        });

        applyFilters();
      })
      .catch(function () {
        statusEl.textContent = "Erro ao carregar events.json";
      });
  </script>
</body>
</html>
